# 环境变量文件使用说明

## 📁 我为您准备了哪些文件？

| 文件名 | 用途 | 推荐场景 |
|--------|------|----------|
| **`.env.vercel.all`** | 包含所有环境变量（前端+后端） | ⭐ 最方便，适合快速查看 |
| `backend/.env.vercel` | 只有后端环境变量 | 创建两个 Vercel 项目时使用 |
| `frontend/.env.vercel` | 只有前端环境变量 | 创建两个 Vercel 项目时使用 |

---

## 🎯 您应该使用哪个文件？

### 情况 1️⃣：创建两个 Vercel 项目（✅ 推荐）

这是最佳实践，前后端独立部署。

**部署后端时**：
1. 创建 Vercel 项目
2. Root Directory = `backend`
3. Import .env → 选择 **`backend/.env.vercel`**

**部署前端时**：
1. 创建另一个 Vercel 项目
2. Root Directory = `frontend`
3. 先编辑 `frontend/.env.vercel`，更新 `VITE_API_BASE_URL` 为后端 URL
4. Import .env → 选择 **`frontend/.env.vercel`**

---

### 情况 2️⃣：只创建一个 Vercel 项目

如果您只想创建一个项目（不推荐）：

**部署后端**：
1. Root Directory = `backend`
2. 从 **`.env.vercel.all`** 中复制 `[BACKEND]` 部分
3. 粘贴到 Vercel 环境变量

**部署前端**：
1. Root Directory = `frontend`
2. 从 **`.env.vercel.all`** 中复制 `[FRONTEND]` 部分
3. 粘贴到 Vercel 环境变量

⚠️ **注意**：这种方式只能部署前端或后端之一，另一个需要用其他平台部署。

---

### 情况 3️⃣：使用 Import .env 功能（⭐ 最推荐）

这是最简单的方式！

**部署后端**：
1. 创建 Vercel 项目，Root Directory = `backend`
2. 点击 **Import .env**
3. 选择 **`backend/.env.vercel`**
4. 一键导入 10 个环境变量 ✅

**部署前端**：
1. 创建 Vercel 项目，Root Directory = `frontend`
2. 先编辑 `frontend/.env.vercel`，更新后端 URL
3. 点击 **Import .env**
4. 选择 **`frontend/.env.vercel`**
5. 一键导入 4 个环境变量 ✅

---

## 🤔 为什么需要两个项目？

### FastAPI 后端需要：
- Python 运行环境
- Serverless Functions
- 不同的构建命令

### React 前端需要：
- Node.js 构建
- 静态文件托管
- 不同的构建命令

**一个 Vercel 项目只能有一套配置**，所以需要分开部署。

---

## 📊 部署架构对比

### 方案 A：两个 Vercel 项目（推荐）

```
GitHub Repo: user-experience-project
│
├─> Vercel 项目 1: ux-rescue-backend
│   ├─ Root Directory: backend/
│   ├─ URL: https://ux-rescue-backend.vercel.app
│   └─ 环境变量：backend/.env.vercel (10 个)
│
└─> Vercel 项目 2: ux-rescue-frontend
    ├─ Root Directory: frontend/
    ├─ URL: https://ux-rescue-frontend.vercel.app
    └─ 环境变量：frontend/.env.vercel (4 个)
```

**优点**：
- ✅ 前后端独立部署
- ✅ 独立的 URL 和配置
- ✅ 可以单独扩展
- ✅ 符合最佳实践

---

### 方案 B：一个 Vercel 项目 + 其他平台

```
GitHub Repo: user-experience-project
│
├─> Vercel: ux-rescue-frontend
│   ├─ Root Directory: frontend/
│   └─ URL: https://ux-rescue-frontend.vercel.app
│
└─> Render/其他: ux-rescue-backend
    └─ URL: https://ux-rescue-backend.onrender.com
```

**问题**：
- ❌ 需要管理两个平台
- ❌ 配置更复杂

---

## 💡 我的建议

### 推荐流程（15 分钟完成）

#### 第 1 步：部署后端（5 分钟）
```bash
1. Vercel Dashboard > Add New > Project
2. 选择 GitHub 仓库
3. Project Name: ux-rescue-backend
4. Root Directory: backend
5. Import .env → 选择 backend/.env.vercel
6. Deploy
7. 记录 URL：https://ux-rescue-backend.vercel.app
```

#### 第 2 步：更新前端配置（1 分钟）
```bash
# 编辑 frontend/.env.vercel
# 将第一行改为：
VITE_API_BASE_URL=https://ux-rescue-backend.vercel.app
```

#### 第 3 步：部署前端（5 分钟）
```bash
1. Vercel Dashboard > Add New > Project
2. 选择同一个 GitHub 仓库
3. Project Name: ux-rescue-frontend
4. Root Directory: frontend
5. Import .env → 选择 frontend/.env.vercel
6. Deploy
7. 记录 URL：https://ux-rescue-frontend.vercel.app
```

#### 第 4 步：更新后端 CORS（3 分钟）
```bash
1. 回到后端项目
2. Settings > Environment Variables
3. 编辑 ALLOWED_ORIGINS
4. 改为：https://ux-rescue-frontend.vercel.app
5. Deployments > Redeploy
```

完成！🎉

---

## 📝 快速参考

### 后端环境变量（10 个）
```
APP_NAME
DEBUG
DATABASE_URL
SUPABASE_URL
SUPABASE_ANON_KEY
SUPABASE_SERVICE_ROLE_KEY
SECRET_KEY
ALGORITHM
ACCESS_TOKEN_EXPIRE_MINUTES
ALLOWED_ORIGINS
```

### 前端环境变量（4 个）
```
VITE_API_BASE_URL
VITE_DEBUG
VITE_SUPABASE_URL
VITE_SUPABASE_ANON_KEY
```

---

## ❓ 常见问题

### Q: 可以只创建一个 Vercel 项目吗？
**A**: 技术上不行。一个项目只能设置一个 Root Directory，只能部署前端或后端之一。

### Q: 创建两个项目会产生额外费用吗？
**A**: 不会！Vercel 免费计划允许无限个项目。

### Q: 两个项目会共享同一个 GitHub 仓库吗？
**A**: 是的！两个项目都连接到同一个仓库，只是使用不同的 Root Directory。

### Q: 如果我改了代码，两个项目都会自动部署吗？
**A**: 默认情况下会。但您可以配置：
- 后端项目只在 `backend/` 目录变更时部署
- 前端项目只在 `frontend/` 目录变更时部署

---

## 🎯 总结

**使用 `.env.vercel.all`** 作为总览和参考。

**实际部署时**：
- 后端 → 使用 `backend/.env.vercel`
- 前端 → 使用 `frontend/.env.vercel`（记得先更新 API URL）

这样最简单、最清晰！✅

---

需要帮助？查看：
- [使用Vercel-Import-功能部署.md](./使用Vercel-Import-功能部署.md) - 详细步骤
- [Vercel环境变量配置指南.md](./Vercel环境变量配置指南.md) - 完整指南
