# Railway ç½‘é¡µéƒ¨ç½²æŒ‡å—

> ğŸŒ **å®Œå…¨é€šè¿‡ç½‘é¡µæ“ä½œ** - æ— éœ€å‘½ä»¤è¡Œï¼Œé€‚åˆé¦–æ¬¡ä½¿ç”¨ Railway çš„ç”¨æˆ·

---

## ğŸ“‹ å‰ç½®å‡†å¤‡

### æ‚¨éœ€è¦ï¼š
- âœ… Railway Hobby Plan è´¦å·ï¼ˆæ‚¨å·²æœ‰ï¼‰
- âœ… GitHub è´¦å·
- âœ… é¡¹ç›®ä»£ç å·²æ¨é€åˆ° GitHub

### GitHub ä»“åº“åœ°å€ï¼š
```
https://github.com/changyoutaxiang/user-experience-project.git
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤ï¼ˆ5ä¸ªé˜¶æ®µï¼‰

### é˜¶æ®µ 1ï¼šè¿æ¥ GitHub ä»“åº“

**1.1 ç™»å½• Railway**
- è®¿é—®ï¼šhttps://railway.app
- ç‚¹å‡»å³ä¸Šè§’ "Login"
- ä½¿ç”¨æ‚¨çš„è´¦å·ç™»å½•

**1.2 åˆ›å»ºæ–°é¡¹ç›®**
- ç‚¹å‡» "New Project"
- é€‰æ‹© "Deploy from GitHub repo"
- å¦‚æœç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œç‚¹å‡» "Configure GitHub App"
- æˆæƒ Railway è®¿é—®æ‚¨çš„ GitHub
- é€‰æ‹©ä»“åº“ï¼š`changyoutaxiang/user-experience-project`
- ç‚¹å‡» "Deploy Now"

**é¢„æœŸç»“æœ**ï¼š
- âœ… Railway ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°é¡¹ç›®ä¸­çš„ `backend` å’Œ `frontend` ç›®å½•
- âœ… å¼€å§‹æ„å»ºè¿‡ç¨‹ï¼ˆå¯èƒ½ä¼šå¤±è´¥ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿˜æ²¡æœ‰æ•°æ®åº“ï¼‰

---

### é˜¶æ®µ 2ï¼šæ·»åŠ  PostgreSQL æ•°æ®åº“

**2.1 æ·»åŠ æ•°æ®åº“**
- åœ¨é¡¹ç›®é¡µé¢ï¼Œç‚¹å‡» "New" æŒ‰é’®
- é€‰æ‹© "Database"
- é€‰æ‹© "Add PostgreSQL"
- ç­‰å¾…æ•°æ®åº“åˆ›å»ºï¼ˆçº¦ 30 ç§’ï¼‰

**2.2 æŸ¥çœ‹æ•°æ®åº“ä¿¡æ¯**
- ç‚¹å‡»åˆšåˆ›å»ºçš„ PostgreSQL æœåŠ¡
- è¿›å…¥ "Variables" æ ‡ç­¾
- æ‚¨ä¼šçœ‹åˆ°ï¼š
  - `DATABASE_URL`
  - `PGHOST`
  - `PGPORT`
  - `PGUSER`
  - `PGPASSWORD`
  - `PGDATABASE`

**é‡è¦**ï¼šå¤åˆ¶ `DATABASE_URL` çš„å€¼ï¼Œåé¢ä¼šç”¨åˆ°ï¼

---

### é˜¶æ®µ 3ï¼šé…ç½®åç«¯æœåŠ¡

**3.1 è¿›å…¥åç«¯æœåŠ¡**
- åœ¨é¡¹ç›®é¡µé¢ï¼Œæ‰¾åˆ° "backend" æœåŠ¡
- ç‚¹å‡»è¿›å…¥

**3.2 è®¾ç½®ç¯å¢ƒå˜é‡**
- ç‚¹å‡» "Variables" æ ‡ç­¾
- ç‚¹å‡» "New Variable" æŒ‰é’®
- é€ä¸ªæ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `SECRET_KEY` | `ç‚¹å‡»ç”Ÿæˆ32ä½éšæœºå­—ç¬¦ä¸²` | JWT å¯†é’¥ |
| `ALGORITHM` | `HS256` | JWT ç®—æ³• |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | `30` | Token è¿‡æœŸæ—¶é—´ |
| `DEBUG` | `False` | ç”Ÿäº§ç¯å¢ƒå…³é—­è°ƒè¯• |
| `ALLOWED_ORIGINS` | `å…ˆç•™ç©ºï¼Œç¨åå¡«å†™` | CORS å…è®¸çš„åŸŸå |

**3.3 ä¿®æ”¹ DATABASE_URL**
- æ‰¾åˆ°è‡ªåŠ¨ç”Ÿæˆçš„ `DATABASE_URL` å˜é‡
- ç‚¹å‡»ç¼–è¾‘ï¼ˆé“…ç¬”å›¾æ ‡ï¼‰
- å°†å€¼ä» `postgresql://...` æ”¹ä¸º `postgresql+asyncpg://...`
  - **ç¤ºä¾‹**ï¼š
    ```
    åŸå§‹ï¼špostgresql://postgres:xxx@postgres.railway.app:5432/railway
    ä¿®æ”¹ä¸ºï¼špostgresql+asyncpg://postgres:xxx@postgres.railway.app:5432/railway
    ```
- ä¿å­˜

**3.4 ç”Ÿæˆåç«¯åŸŸå**
- ç‚¹å‡» "Settings" æ ‡ç­¾
- æ‰¾åˆ° "Networking" éƒ¨åˆ†
- ç‚¹å‡» "Generate Domain"
- ä¼šå¾—åˆ°ç±»ä¼¼ï¼š`https://ux-rescue-backend-production.up.railway.app`
- **å¤åˆ¶å¹¶ä¿å­˜è¿™ä¸ª URLï¼**

**3.5 é‡æ–°éƒ¨ç½²åç«¯**
- ç‚¹å‡» "Deployments" æ ‡ç­¾
- ç‚¹å‡»æœ€æ–°éƒ¨ç½²å³ä¾§çš„ä¸‰ç‚¹èœå•
- é€‰æ‹© "Redeploy"
- ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰

**3.6 æ£€æŸ¥éƒ¨ç½²çŠ¶æ€**
- éƒ¨ç½²æˆåŠŸåï¼Œç‚¹å‡» "View Logs" æŸ¥çœ‹æ—¥å¿—
- åº”è¯¥çœ‹åˆ°ï¼š
  ```
  âœ… Running alembic upgrade head
  âœ… Starting uvicorn server
  âœ… Application startup complete
  ```

---

### é˜¶æ®µ 4ï¼šé…ç½®å‰ç«¯æœåŠ¡

**4.1 è¿›å…¥å‰ç«¯æœåŠ¡**
- è¿”å›é¡¹ç›®é¡µé¢
- æ‰¾åˆ° "frontend" æœåŠ¡
- ç‚¹å‡»è¿›å…¥

**4.2 è®¾ç½®ç¯å¢ƒå˜é‡**
- ç‚¹å‡» "Variables" æ ‡ç­¾
- ç‚¹å‡» "New Variable"
- æ·»åŠ å˜é‡ï¼š

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `VITE_API_BASE_URL` | `æ‚¨çš„åç«¯URL` | åç«¯ API åœ°å€ |

**ç¤ºä¾‹**ï¼š
```
VITE_API_BASE_URL=https://ux-rescue-backend-production.up.railway.app
```

**æ³¨æ„**ï¼šä½¿ç”¨æ‚¨åœ¨é˜¶æ®µ 3.4 å¤åˆ¶çš„åç«¯ URLï¼

**4.3 ç”Ÿæˆå‰ç«¯åŸŸå**
- ç‚¹å‡» "Settings" æ ‡ç­¾
- æ‰¾åˆ° "Networking" éƒ¨åˆ†
- ç‚¹å‡» "Generate Domain"
- ä¼šå¾—åˆ°ç±»ä¼¼ï¼š`https://ux-rescue-frontend-production.up.railway.app`
- **å¤åˆ¶å¹¶ä¿å­˜è¿™ä¸ª URLï¼**

**4.4 é‡æ–°éƒ¨ç½²å‰ç«¯**
- ç‚¹å‡» "Deployments" æ ‡ç­¾
- ç‚¹å‡» "Redeploy"
- ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰

---

### é˜¶æ®µ 5ï¼šå®Œæˆé…ç½®

**5.1 æ›´æ–°åç«¯ CORS è®¾ç½®**
- è¿”å› **åç«¯æœåŠ¡** é¡µé¢
- ç‚¹å‡» "Variables" æ ‡ç­¾
- æ‰¾åˆ° `ALLOWED_ORIGINS` å˜é‡ï¼ˆæˆ–æ–°å»ºï¼‰
- è®¾ç½®å€¼ä¸ºæ‚¨çš„å‰ç«¯ URLï¼š
  ```
  https://ux-rescue-frontend-production.up.railway.app
  ```
- ä¿å­˜åï¼Œç‚¹å‡» "Deployments" -> "Redeploy"

**5.2 è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–**

ç”±äºç½‘é¡µæ— æ³•ç›´æ¥è¿è¡Œå‘½ä»¤ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ Railway CLI æˆ–è€…è·³è¿‡è¿™ä¸€æ­¥ã€‚

**é€‰é¡¹ A - ä¸´æ—¶å®‰è£… Railway CLI**ï¼š
```bash
# åœ¨æ‚¨çš„æœ¬åœ°ç»ˆç«¯è¿è¡Œ
brew install railway
railway login
railway link  # é€‰æ‹©æ‚¨çš„é¡¹ç›®
railway service backend
railway run python -m src.utils.seed_data
```

**é€‰é¡¹ B - æ‰‹åŠ¨åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·**ï¼š
- éƒ¨ç½²åå…ˆè®¿é—®å‰ç«¯
- ä½¿ç”¨æ³¨å†ŒåŠŸèƒ½åˆ›å»ºè´¦æˆ·
- æˆ–è€…é€šè¿‡ API æ–‡æ¡£åˆ›å»ºï¼šè®¿é—® `https://æ‚¨çš„åç«¯URL/docs`

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥åç«¯å¥åº·

è®¿é—®ï¼š`https://æ‚¨çš„åç«¯URL/health`

**åº”è¯¥çœ‹åˆ°**ï¼š
```json
{
  "status": "healthy",
  "app": "ç”¨æˆ·ä½“éªŒæ‹¯æ•‘é¡¹ç›®ç®¡ç†ç³»ç»Ÿ"
}
```

### 2. è®¿é—® API æ–‡æ¡£

è®¿é—®ï¼š`https://æ‚¨çš„åç«¯URL/docs`

**åº”è¯¥çœ‹åˆ°**ï¼šSwagger UI ç•Œé¢ï¼Œæ˜¾ç¤ºæ‰€æœ‰ API ç«¯ç‚¹

### 3. è®¿é—®å‰ç«¯åº”ç”¨

è®¿é—®ï¼š`https://æ‚¨çš„å‰ç«¯URL`

**åº”è¯¥çœ‹åˆ°**ï¼šç™»å½•é¡µé¢

### 4. æµ‹è¯•ç™»å½•

å¦‚æœå·²è¿è¡Œç§å­æ•°æ®è„šæœ¬ï¼Œä½¿ç”¨ï¼š
- **é‚®ç®±**ï¼šadmin@example.com
- **å¯†ç **ï¼šadmin123456

---

## ğŸ“Š éƒ¨ç½²æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Railway Project                 â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Frontend   â”‚  â”‚   Backend    â”‚   â”‚
â”‚  â”‚              â”‚  â”‚              â”‚   â”‚
â”‚  â”‚  Node.js 18  â”‚â†’â†’â”‚  Python 3.11 â”‚   â”‚
â”‚  â”‚  Vite Build  â”‚  â”‚  FastAPI     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚            â”‚
â”‚                            â†“            â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚                  â”‚ PostgreSQL   â”‚      â”‚
â”‚                  â”‚   Database   â”‚      â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: åç«¯éƒ¨ç½²å¤±è´¥ï¼Œæ˜¾ç¤º "Build failed"

**å¯èƒ½åŸå› **ï¼š
- nixpacks.toml é…ç½®é—®é¢˜
- requirements.txt ä¾èµ–é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ï¼ˆDeployments -> View Logsï¼‰
2. ç¡®è®¤ `backend/nixpacks.toml` å­˜åœ¨
3. ç¡®è®¤ `backend/requirements.txt` å­˜åœ¨

### Q2: å‰ç«¯æ— æ³•è¿æ¥åç«¯ï¼Œæ˜¾ç¤º CORS é”™è¯¯

**åŸå› **ï¼šåç«¯ `ALLOWED_ORIGINS` æœªæ­£ç¡®é…ç½®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. è¿›å…¥åç«¯æœåŠ¡ -> Variables
2. æ£€æŸ¥ `ALLOWED_ORIGINS` å€¼æ˜¯å¦ä¸ºå‰ç«¯çš„å®Œæ•´ URL
3. é‡æ–°éƒ¨ç½²åç«¯

### Q3: æ•°æ®åº“è¿æ¥å¤±è´¥

**åŸå› **ï¼š`DATABASE_URL` æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ `DATABASE_URL` ä»¥ `postgresql+asyncpg://` å¼€å¤´
2. ä¸æ˜¯ `postgresql://`
3. ä¿®æ”¹åé‡æ–°éƒ¨ç½²

### Q4: ç™»å½•æ—¶æç¤º "Invalid credentials"

**åŸå› **ï¼šæ•°æ®åº“ä¸­æ²¡æœ‰ç”¨æˆ·æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è¿è¡Œç§å­æ•°æ®è„šæœ¬ï¼ˆè§é˜¶æ®µ 5.2ï¼‰
- æˆ–ä½¿ç”¨æ³¨å†ŒåŠŸèƒ½åˆ›å»ºæ–°ç”¨æˆ·

---

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹éƒ¨ç½²å‰ï¼š
- [ ] GitHub ä»“åº“å·²åˆ›å»ºå¹¶æ¨é€ä»£ç 
- [ ] å·²æœ‰ Railway Hobby Plan è´¦å·
- [ ] backend/nixpacks.toml å­˜åœ¨
- [ ] frontend/nixpacks.toml å­˜åœ¨

éƒ¨ç½²è¿‡ç¨‹ä¸­ï¼š
- [ ] Railway é¡¹ç›®å·²åˆ›å»º
- [ ] PostgreSQL æ•°æ®åº“å·²æ·»åŠ 
- [ ] åç«¯ç¯å¢ƒå˜é‡å·²è®¾ç½®ï¼ˆ5ä¸ªï¼‰
- [ ] DATABASE_URL å·²ä¿®æ”¹ä¸º asyncpg æ ¼å¼
- [ ] åç«¯åŸŸåå·²ç”Ÿæˆ
- [ ] å‰ç«¯ç¯å¢ƒå˜é‡å·²è®¾ç½®ï¼ˆVITE_API_BASE_URLï¼‰
- [ ] å‰ç«¯åŸŸåå·²ç”Ÿæˆ
- [ ] ALLOWED_ORIGINS å·²æ›´æ–°

éƒ¨ç½²å®Œæˆåï¼š
- [ ] åç«¯å¥åº·æ£€æŸ¥é€šè¿‡ (/health)
- [ ] API æ–‡æ¡£å¯è®¿é—® (/docs)
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] å¯ä»¥æˆåŠŸç™»å½•

---

## ğŸ“ å…³é”®ä¿¡æ¯è®°å½•

éƒ¨ç½²è¿‡ç¨‹ä¸­è¯·è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š

| é¡¹ç›® | URL/å€¼ | å¤‡æ³¨ |
|------|--------|------|
| **åç«¯ URL** | https://________________.railway.app | é˜¶æ®µ 3.4 ç”Ÿæˆ |
| **å‰ç«¯ URL** | https://________________.railway.app | é˜¶æ®µ 4.3 ç”Ÿæˆ |
| **æ•°æ®åº“ URL** | postgresql+asyncpg://_______ | é˜¶æ®µ 2.2 å¤åˆ¶ |
| **SECRET_KEY** | ________________________________ | é˜¶æ®µ 3.2 ç”Ÿæˆ |

---

## ğŸ‰ å®Œæˆï¼

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸé€šè¿‡ Railway ç½‘é¡µéƒ¨ç½²äº†å®Œæ•´çš„é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼

**ä¸‹ä¸€æ­¥å¯ä»¥åšä»€ä¹ˆ**ï¼š

1. **é‚€è¯·å›¢é˜Ÿæˆå‘˜**
   - åœ¨ Railway é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ æˆå‘˜

2. **é…ç½®è‡ªå®šä¹‰åŸŸå**ï¼ˆå¯é€‰ï¼‰
   - Settings -> Networking -> Custom Domain

3. **è®¾ç½®ç›‘æ§å‘Šè­¦**
   - åœ¨ Railway Dashboard æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ

4. **å¼€å§‹ä½¿ç”¨ç³»ç»Ÿ**
   - åˆ›å»ºé¡¹ç›®
   - æ·»åŠ ä»»åŠ¡
   - ç®¡ç†å›¢é˜Ÿ

---

## ğŸ’¡ æç¤º

- **è‡ªåŠ¨éƒ¨ç½²**ï¼šæ¯æ¬¡æ¨é€åˆ° GitHub ä¸»åˆ†æ”¯ï¼ŒRailway ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²
- **æŸ¥çœ‹æ—¥å¿—**ï¼šä»»ä½•æ—¶å€™éƒ½å¯ä»¥åœ¨ Deployments æ ‡ç­¾æŸ¥çœ‹æ—¥å¿—
- **ç›‘æ§ç”¨é‡**ï¼šåœ¨é¡¹ç›®çš„ Usage æ ‡ç­¾æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
- **æˆæœ¬æ§åˆ¶**ï¼šHobby Plan æä¾› $5/æœˆå…è´¹é¢åº¦ï¼Œæœ¬é¡¹ç›®é¢„è®¡ä½¿ç”¨ $2-4/æœˆ

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥éƒ¨ç½²æ—¥å¿—ï¼ˆDeployments -> View Logsï¼‰
2. æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼ˆVariables æ ‡ç­¾ï¼‰
3. å‚è€ƒå¸¸è§é—®é¢˜éƒ¨åˆ†
4. æŸ¥çœ‹ Railway æ–‡æ¡£ï¼šhttps://docs.railway.app

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€
